<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard</title>

  <link rel="shortcut icon" href="./assets/compiled/svg/favicon.svg" type="image/x-icon" />
  <link rel="shortcut icon"
    href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACEAAAAiCAYAAADRcLDBAAAEs2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgZXhpZjpQaXhlbFhEaW1lbnNpb249IjMzIgogICBleGlmOlBpeGVsWURpbWVuc2lvbj0iMzQiCiAgIGV4aWY6Q29sb3JTcGFjZT0iMSIKICAgdGlmZjpJbWFnZVdpZHRoPSIzMyIKICAgdGlmZjpJbWFnZUxlbmd0aD0iMzQiCiAgIHRpZmY6UmVzb2x1dGlvblVuaXQ9IjIiCiAgIHRpZmY6WFJlc29sdXRpb249Ijk2LjAiCiAgIHRpZmY6WVJlc29sdXRpb249Ijk2LjAiCiAgIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiCiAgIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjItMDMtMzFUMTA6NTA6MjMrMDI6MDAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjItMDMtMzFUMTA6NTA6MjMrMDI6MDAiPgogICA8eG1wTU06SGlzdG9yeT4KICAgIDxyZGY6U2VxPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJwcm9kdWNlZCIKICAgICAgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWZmaW5pdHkgRGVzaWduZXIgMS4xMC4xIgogICAgICBzdEV2dDp3aGVuPSIyMDIyLTAzLTMxVDEwOjUwOjIzKzAyOjAwIi8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9InIiPz5V57uAAAABgmlDQ1BzUkdCIElFQzYxOTY2LTIuMQAAKJF1kc8rRFEUxz9maORHo1hYKC9hISNGTWwsRn4VFmOUX5uZZ36oeTOv954kW2WrKLHxa8FfwFZZK0WkZClrYoOe87ypmWTO7dzzud97z+nec8ETzaiaWd4NWtYyIiNhZWZ2TvE946WZSjqoj6mmPjE1HKWkfdxR5sSbgFOr9Ll/rXoxYapQVik8oOqGJTwqPL5i6Q5vCzeo6dii8KlwpyEXFL519LjLLw6nXP5y2IhGBsFTJ6ykijhexGra0ITl5bRqmWU1fx/nJTWJ7PSUxBbxJkwijBBGYYwhBgnRQ7/MIQIE6ZIVJfK7f/MnyUmuKrPOKgZLpEhj0SnqslRPSEyKnpCRYdXp/9++msneoFu9JgwVT7b91ga+LfjetO3PQ9v+PgLvI1xkC/m5A+h7F32zoLXug38dzi4LWnwHzjeg8UGPGbFfySvuSSbh9QRqZ6H+Gqrm3Z7l9zm+h+iafNUV7O5Bu5z3L/wAdthn7QIme0YAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAJTSURBVFiF7Zi9axRBGIefEw2IdxFBRQsLWUTBaywSK4ubdSGVIY1Y6HZql8ZKCGIqwX/AYLmCgVQKfiDn7jZeEQMWfsSAHAiKqPiB5mIgELWYOW5vzc3O7niHhT/YZvY37/swM/vOzJbIqVq9uQ04CYwCI8AhYAlYAB4Dc7HnrOSJWcoJcBS4ARzQ2F4BZ2LPmTeNuykHwEWgkQGAet9QfiMZjUSt3hwD7psGTWgs9pwH1hC1enMYeA7sKwDxBqjGnvNdZzKZjqmCAKh+U1kmEwi3IEBbIsugnY5avTkEtIAtFhBrQCX2nLVehqyRqFoCAAwBh3WGLAhbgCRIYYinwLolwLqKUwwi9pxV4KUlxKKKUwxC6ZElRCPLYAJxGfhSEOCz6m8HEXvOB2CyIMSk6m8HoXQTmMkJcA2YNTHm3congOvATo3tE3A29pxbpnFzQSiQPcB55IFmFNgFfEQeahaAGZMpsIJIAZWAHcDX2HN+2cT6r39GxmvC9aPNwH5gO1BOPFuBVWAZue0vA9+A12EgjPadnhCuH1WAE8ivYAQ4ohKaagV4gvxi5oG7YSA2vApsCOH60WngKrA3R9IsvQUuhIGY00K4flQG7gHH/mLytB4C42EgfrQb0mV7us8AAMeBS8mGNMR4nwHamtBB7B4QRNdaS0M8GxDEog7iyoAguvJ0QYSBuAOcAt71Kfl7wA8DcTvZ2KtOlJEr+ByyQtqqhTyHTIeB+ONeqi3brh+VgIN0fohUgWGggizZFTplu12yW8iy/YLOGWMpDMTPXnl+Az9vj2HERYqPAAAAAElFTkSuQmCC"
    type="image/png" />
  <link rel="stylesheet" href="./assets/compiled/css/app.css" />
  <link rel="stylesheet" href="./assets/compiled/css/app-dark.css" />
  <link rel="stylesheet" href="./assets/compiled/css/fan.css" />
  <link rel="stylesheet" href="./assets/compiled/css/mode.css" />
  <link rel="stylesheet" href="./assets/compiled/css/led.css" />
  <link rel="stylesheet" href="./assets/compiled/css/daynight.css" />
  <link rel="stylesheet" href="./assets/compiled/css/clock.css" />
  <link rel="stylesheet" href="./assets/compiled/css/loading.css" />
  <style>
    #opaque {
      position: fixed;
      top: 0px;
      left: 0px;
      width: 100%;
      height: 100%;
      z-index: 1000;
      display: none;
      background-color: black;
      filter: alpha(opacity=30);
      opacity: 0.3;
    }
  </style>
</head>

<body>
  <script src="assets/static/js/initTheme.js"></script>
  <div id="app">
    <div id="sidebar">
      <div class="sidebar-wrapper active">
        <div class="sidebar-header position-relative">
          <div class="d-flex justify-content-between align-items-center">
            <div class="logo">
              <a href="dashboard.html" style="font-size: 1.3rem">sleep monitor</a>
            </div>
            <div class="theme-toggle d-flex gap-2 align-items-center mt-2">
              <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true"
                role="img" class="iconify iconify--system-uicons" width="20" height="20"
                preserveAspectRatio="xMidYMid meet" viewBox="0 0 21 21">
                <g fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                  <path
                    d="M10.5 14.5c2.219 0 4-1.763 4-3.982a4.003 4.003 0 0 0-4-4.018c-2.219 0-4 1.781-4 4c0 2.219 1.781 4 4 4zM4.136 4.136L5.55 5.55m9.9 9.9l1.414 1.414M1.5 10.5h2m14 0h2M4.135 16.863L5.55 15.45m9.899-9.9l1.414-1.415M10.5 19.5v-2m0-14v-2"
                    opacity=".3"></path>
                  <g transform="translate(-210 -1)">
                    <path d="M220.5 2.5v2m6.5.5l-1.5 1.5"></path>
                    <circle cx="220.5" cy="11.5" r="4"></circle>
                    <path d="m214 5l1.5 1.5m5 14v-2m6.5-.5l-1.5-1.5M214 18l1.5-1.5m-4-5h2m14 0h2"></path>
                  </g>
                </g>
              </svg>
              <div class="form-check form-switch fs-6">
                <input class="form-check-input me-0" type="checkbox" id="toggle-dark" style="cursor: pointer" />
                <label class="form-check-label"></label>
              </div>
              <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true"
                role="img" class="iconify iconify--mdi" width="20" height="20" preserveAspectRatio="xMidYMid meet"
                viewBox="0 0 24 24">
                <path fill="currentColor"
                  d="m17.75 4.09l-2.53 1.94l.91 3.06l-2.63-1.81l-2.63 1.81l.91-3.06l-2.53-1.94L12.44 4l1.06-3l1.06 3l3.19.09m3.5 6.91l-1.64 1.25l.59 1.98l-1.7-1.17l-1.7 1.17l.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95l2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85c-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14c.4-.4.82-.76 1.27-1.08c.75-.53 1.93.36 1.85 1.19c-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82c-2.81 3.14-2.7 7.96.31 10.98c3.02 3.01 7.84 3.12 10.98.31Z">
                </path>
              </svg>
            </div>
            <div class="sidebar-toggler x">
              <a href="#" class="sidebar-hide d-xl-none d-block"><i class="bi bi-x bi-middle"></i></a>
            </div>
          </div>
        </div>
        <div class="sidebar-menu">
          <ul class="menu">
            <li class="sidebar-title">Menu</li>

            <li class="sidebar-item active">
              <a href="dashboard.html" class="sidebar-link">
                <i class="bi bi-grid-fill"></i>
                <span>Dashboard</span>
              </a>
            </li>
            <li class="sidebar-item">
              <a href="history.html" class="sidebar-link">
                <i class="bi bi-calendar-week-fill"></i>
                <span>History</span>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div id="main" class="layout-navbar navbar-fixed">
      <header>
        <nav class="navbar navbar-expand navbar-light navbar-top">
          <div class="container-fluid">
            <a href="#" class="burger-btn d-block">
              <i class="bi bi-justify fs-3"></i>
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
              data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
              aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
              <ul class="navbar-nav ms-auto mb-lg-0">
                <!-- <li class="nav-item dropdown me-1">
                    <a
                      class="nav-link active dropdown-toggle text-gray-600"
                      href="#"
                      data-bs-toggle="dropdown"
                      aria-expanded="false"
                    >
                      <i class="bi bi-envelope bi-sub fs-4"></i>
                    </a>
                    <ul
                      class="dropdown-menu dropdown-menu-end"
                      aria-labelledby="dropdownMenuButton"
                    >
                      <li>
                        <h6 class="dropdown-header">Mail</h6>
                      </li>
                      <li><a class="dropdown-item" href="#">No new mail</a></li>
                    </ul>
                  </li>
                  <li class="nav-item dropdown me-3">
                    <a
                      class="nav-link active dropdown-toggle text-gray-600"
                      href="#"
                      data-bs-toggle="dropdown"
                      data-bs-display="static"
                      aria-expanded="false"
                    >
                      <i class="bi bi-bell bi-sub fs-4"></i>
                      <span class="badge badge-notification bg-danger">7</span>
                    </a>
                    <ul
                      class="dropdown-menu dropdown-menu-end notification-dropdown"
                      aria-labelledby="dropdownMenuButton"
                    >
                      <li class="dropdown-header">
                        <h6>Notifications</h6>
                      </li>
                      <li class="dropdown-item notification-item">
                        <a class="d-flex align-items-center" href="#">
                          <div class="notification-icon bg-primary">
                            <i class="bi bi-cart-check"></i>
                          </div>
                          <div class="notification-text ms-4">
                            <p class="notification-title font-bold">
                              Successfully check out
                            </p>
                            <p class="notification-subtitle font-thin text-sm">
                              Order ID #256
                            </p>
                          </div>
                        </a>
                      </li>
                      <li class="dropdown-item notification-item">
                        <a class="d-flex align-items-center" href="#">
                          <div class="notification-icon bg-success">
                            <i class="bi bi-file-earmark-check"></i>
                          </div>
                          <div class="notification-text ms-4">
                            <p class="notification-title font-bold">
                              Homework submitted
                            </p>
                            <p class="notification-subtitle font-thin text-sm">
                              Algebra math homework
                            </p>
                          </div>
                        </a>
                      </li>
                      <li>
                        <p class="text-center py-2 mb-0">
                          <a href="#">See all notification</a>
                        </p>
                      </li>
                    </ul>
                  </li> -->
              </ul>
              <div class="dropdown">
                <a href="#" data-bs-toggle="dropdown" aria-expanded="false">
                  <div class="user-menu d-flex align-items-center">
                    <div class="user-name text-end me-3">
                      <h6 class="text-gray-600 mb-0" id="loginName"></h6>
                      <!-- <p class="mb-0 text-sm text-gray-600">Administrator</p> -->
                    </div>
                    <div class="user-img d-flex align-items-center">
                      <div class="avatar avatar-md">
                        <img src="./assets/compiled/jpg/1.jpg" />
                      </div>
                    </div>
                  </div>
                </a>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton"
                  style="min-width: 11rem">
                  <li>
                    <h6 class="dropdown-header">Hello, <span id="helloName"></span>!</h6>
                  </li>
                  <li>
                    <a class="dropdown-item" href="login.html"><i class="icon-mid bi bi-box-arrow-left me-2"></i>
                      Logout</a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </nav>
      </header>
      <div id="main-content">
        <div class="page-heading">
          <div class="page-title">
            <div class="row">
              <div class="col-12 col-md-6 order-md-1 order-last">
                <h3>Dashboard</h3>
                <!-- <p class="text-subtitle text-muted">
                    Navbar will appear on the top of the page.
                  </p> -->
              </div>
              <!-- <div class="col-12 col-md-6 order-md-2 order-first">
                  <nav
                    aria-label="breadcrumb"
                    class="breadcrumb-header float-start float-lg-end"
                  >
                    <ol class="breadcrumb">
                      <li class="breadcrumb-item">
                        <a href="index.html">Dashboard</a>
                      </li>
                      <li class="breadcrumb-item active" aria-current="page">
                        Layout Vertical Navbar
                      </li>
                    </ol>
                  </nav>
                </div> -->
            </div>
          </div>
        </div>
        <div class="page-content">
          <section class="section">
            <div class="row">
              <div class="col-md-3 mb-4">
                <div class="card border border-dark h-100">
                  <div class="card-body">
                    <h5 class="card-title pb-3">Current environment</h5>
                    <div class="form form-horizontal">
                      <div class="row">
                        <div class="col-md-5">
                          <i class="bi-thermometer"></i>
                          <label>Temperature</label>
                        </div>
                        <div id="currentTemp" class="col-md-7 form-group"></div>
                        <div class="col-md-5">
                          <i class="bi-droplet-half"></i>
                          <label>Humidity</label>
                        </div>
                        <div id="currentHumid" class="col-md-7 form-group"></div>
                        <div class="col-md-5">
                          <i class="bi-lightbulb"></i>
                          <label>Light</label>
                        </div>
                        <div id="currentLight" class="col-md-7 form-group"></div>
                      </div>
                    </div>
                    <div id="knnPrediction">
                    </div>
                    <!-- <p>Good sleep count: <span id="goodCount"></span></p>
                    <p>Bad sleep count: <span id="badCount"></span></p> -->
                    <p hidden>Percentage of good sleep: <span id="qualityPercentage"></span></p>
                    <h5 class="card-title pb-3 pt-4">Ideal environment</h5>
                    <div class="form form-horizontal">
                      <div class="row">
                        <div class="col-md-5">
                          <i class="bi-thermometer"></i>
                          <label>Temperature</label>
                        </div>
                        <div class="col-md-7 form-group">
                          <span class="form-control" readonly id="idealTemp">

                          </span>
                        </div>
                        <div class="col-md-5">
                          <i class="bi-droplet-half"></i>
                          <label>Humidity</label>
                        </div>
                        <div class="col-md-7 form-group">
                          <span class="form-control" readonly id="idealHumid"></span>
                        </div>
                        <div class="col-md-5">
                          <i class="bi-lightbulb"></i>
                          <label>Light</label>
                        </div>
                        <div class="col-md-7 form-group">
                          <span class="form-control" readonly id="idealLight"></span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-3 mb-4">
                <div id="hehe" class="card border border-dark h-100">
                  <input id="sleepSwitch" class="switch" type="checkbox" />
                  <div class="switch-day-night">
                    <div class="top">
                      <div class="sun-moon"></div>
                      <div class="cloud a"><span></span></div>
                      <div class="cloud b"><span></span></div>
                      <div class="cloud c"><span></span></div>
                    </div>
                    <div class="bottom">
                      <div class="text" data-day="It's morning!" data-night="Good night."></div>
                      <label class="label" for="sleepSwitch">&nbsp;</label>
                    </div>
                  </div>
                  <div class="card-body pb-0">
                    <h5 class="card-title pb-3" id="envTitle"></h5>
                    <div class="form form-horizontal">
                      <div class="row">
                        <div class="col-md-5">
                          <i class="bi-thermometer"></i>
                          <label>Temperature</label>
                        </div>
                        <div class="col-md-7 form-group">
                          <span class="form-control" id="tempRender" readonly></span>
                        </div>
                        <div class="col-md-5">
                          <i class="bi-droplet-half"></i>
                          <label>Humidity</label>
                        </div>
                        <div class="col-md-7 form-group">
                          <span class="form-control" id="humidRender" readonly></span>
                        </div>
                        <div class="col-md-5">
                          <i class="bi-lightbulb"></i>
                          <label>Light</label>
                        </div>
                        <div class="col-md-7 form-group">
                          <span class="form-control" id="lightRender" readonly></span>
                        </div>
                      </div>
                    </div>
                    <div id="qualityRender">

                    </div>
                    <div id="qualityQuestion" style="display:none">
                      <h5 class="card-title pb-3 pt-4">
                        Did you sleep well last night?
                      </h5>
                      <div>
                        <div class="form-check">
                          <input class="form-check-input" type="radio" name="sleepWell" id="sleepYes" />
                          <label class="form-check-label" for="sleepYes">
                            Yes
                          </label>
                        </div>
                        <div class="form-check">
                          <input class="form-check-input" type="radio" name="sleepWell" id="sleepNo" />
                          <label class="form-check-label" for="sleepNo">
                            No
                          </label>
                        </div>
                        <div class="d-flex justify-content-end">
                          <button type="button" id="submitYesNo" class="btn btn-primary me-1 mb-1">
                            Submit
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-3">
                <div class="row h-100">
                  <div class="col-12 mb-4">
                    <div class="card border border-dark h-100 d-flex justify-content-evenly align-items-center">
                      <div class="clockBox">
                        <div class="clock">
                          <div class="hour"></div>
                          <div class="min"></div>
                          <div class="sec"></div>
                        </div>
                      </div>
                      <div class="loadingBox d-flex align-items-center" style="height:50px">
                        <div id="loading" style="display:none">
                          <div class="dot"></div>
                          <div class="dot"></div>
                          <div class="dot"></div>
                          <div class="dot"></div>
                          <div class="dot"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-12 mb-4">
                    <div class="card border border-dark h-100">
                      <div class="card-header pb-0">
                        <h4 class="card-title">LED Control</h4>
                      </div>
                      <div class="card-body d-flex justify-content-center align-items-center">
                        <div class="switchLEDcss">
                          <input type="checkbox" name="toggle" id="ledSwitch" />
                          <label for="ledSwitch">
                            <i class="bulb">
                              <span class="bulb-center"></span>
                              <span class="filament-1"></span>
                              <span class="filament-2"></span>
                              <span class="reflections">
                                <span></span>
                              </span>
                              <span class="sparks">
                                <i class="spark1"></i>
                                <i class="spark2"></i>
                                <i class="spark3"></i>
                                <i class="spark4"></i>
                              </span>
                            </i>
                          </label>
                        </div>

                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-3 mb-4">
                <div class="card border border-dark h-100">
                  <div class="card-header">
                    <h4 class="card-title">Fan Control</h4>
                  </div>
                  <div class="card-body d-flex flex-column justify-content-evenly">
                    <div class="can-toggle demo-rebrand-1">
                      <input id="fanMode" type="checkbox">
                      <label for="fanMode" id="modeBox" class="d-flex justify-content-center">
                        <div class="can-toggle__switch" data-checked="auto" data-unchecked="manual"></div>
                      </label>
                    </div>
                    <div class="container d-flex justify-content-center align-items-center"
                      style="transform: rotate(90deg);">
                      <div class="donut-chart-block block">
                        <div class="donut-chart">
                          <div id="section1" class="clip">
                            <div class="item"></div>
                          </div>
                          <div id="section2" class="clip">
                            <div class="item"></div>
                          </div>
                          <div id="section3" class="clip">
                            <div class="item"></div>
                          </div>
                          <div class="center" style="transform: rotate(-90deg);">
                            <span></span>
                          </div>
                        </div>
                      </div>
                      <div class="range-slider" id="fanSliderBox">
                        <input type="range" orient="vertical" min="0" max="100" step="25" id="fanSliderValue" />
                        <div class="range-slider__bar"></div>
                        <div class="range-slider__thumb" id="sliderThumb" style="transform: rotate(-90deg);"></div>
                      </div>
                    </div>
                  </div>


                </div>
              </div>
              <div class="col-md-4">
                <div class="card border border-dark h-100">
                  <div class="card-header">
                    <h4 class="card-title">Temperature Chart</h4>
                  </div>
                  <div class="card-body">
                    <canvas id="temp"></canvas>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="card border border-dark h-100">
                  <div class="card-header">
                    <h4 class="card-title">Humidity Chart</h4>
                  </div>
                  <div class="card-body">
                    <canvas id="humid"></canvas>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="card border border-dark h-100">
                  <div class="card-header">
                    <h4 class="card-title">Light Chart</h4>
                  </div>
                  <div class="card-body">
                    <canvas id="light"></canvas>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>
      </div>
      <footer>
        <!-- <div class="footer clearfix mb-0 text-muted">
            <div class="float-start">
              <p>2023 &copy; Mazer</p>
            </div>
            <div class="float-end">
              <p>
                Crafted with
                <span class="text-danger"
                  ><i class="bi bi-heart-fill icon-mid"></i
                ></span>
                by <a href="https://saugi.me">Saugi</a>
              </p>
            </div>
          </div> -->
      </footer>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/mathjs@11.8.0/lib/browser/math.min.js"></script>
  <script src="assets/extensions/chart.js/chart.umd.js"></script>
  <!-- <script src="assets/static/js/pages/ui-chartjs.js"></script> -->
  <!-- ----------------------------------------------------------------------------------------------------------------------------------------------------- -->
  <script>
    // some var
    let username = sessionStorage.getItem("username");
    let aiokey = "aio_ruiV8486TRzDh0QOrwsUdc6XRwGE";
    let varDeviceFan = "device_fan";
    let varDeviceLed = "device_light";
    let varMode = "mode";
    let varSensorHumid = "sensor_humid";
    let varSensorLight = "sensor_light";
    let varSensorTemp = "sensor_temp";
    var currTime = new Date();
    let matrix = [];
    let idealTemp;
    let idealHumid;
    let idealLight;
    let dbHumidArray = [];
    let db
    currTime = currTime.toLocaleTimeString();
    let globalTheta;
    document.getElementById("loginName").innerHTML = username
    document.getElementById("helloName").innerHTML = username
    // Some functions
    function setLabels(labels) {
      var newTime = new Date();
      newTime = newTime.toLocaleTimeString();
      labels.push(newTime);
      labels.shift();
    }
    function setData(data, newData, env) {
      data.push(newData);
      data.shift();
      if (env == "temp") {
        sessionStorage.setItem("tempSessionChart", JSON.stringify(data));
      }
      if (env == "humid") {
        sessionStorage.setItem("humidSessionChart", JSON.stringify(data));
      }
      if (env == "light") {
        sessionStorage.setItem("lightSessionChart", JSON.stringify(data));
      }
    }
    async function fetchStuff(str) {
      const response = await fetch(str);
      const data = await response.json();
      return data;
    }
    async function postpatchData(url = "", data = {}, apiMethod) {
      // Default options are marked with *
      const response = await fetch(url, {
        method: apiMethod, // *GET, POST, PUT, DELETE, etc.
        mode: "cors", // no-cors, *cors, same-origin
        cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
        credentials: "same-origin", // include, *same-origin, omit
        headers: {
          "Content-Type": "application/json",
          "X-AIO-Key": aiokey,
          // 'Content-Type': 'application/x-www-form-urlencoded',
        },
        redirect: "follow", // manual, *follow, error
        referrerPolicy: "no-referrer", // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
        body: JSON.stringify(data), // body data type must match "Content-Type" header
      });
      return response.json(); // parses JSON response into native JavaScript objects
    }

    // logistic regression
    async function buildLogistic() {
      let history = await fetchStuff(
        `http://localhost:5000/history?username=${username}`
      );
      if (history.length > 0) {
        let idealTempArray = []
        let idealHumidArray = []
        let idealLightArray = []
        for (let his of history) {
          let qua;
          if (his.quality == "good") {
            qua = 1
            idealTempArray.push(his.temp)
            idealHumidArray.push(his.humid)
            idealLightArray.push(his.light)
          }
          else {
            qua = 0
          }
          matrix.push([his.temp, his.humid, his.light, qua])
        }
        // Part -1: calculate ideal
        idealTemp = parseFloat(
          idealTempArray.reduce((a, b) => a + b, 0) / idealTempArray.length
        ).toFixed(1);
        idealHumid = parseFloat(
          idealHumidArray.reduce((a, b) => a + b, 0) / idealHumidArray.length
        ).toFixed(0);
        idealLight = parseFloat(
          idealLightArray.reduce((a, b) => a + b, 0) / idealLightArray.length
        ).toFixed(0);
        // Part 0: Preparation

        let X = math.evaluate('matrix[:, 1:3]', {
          matrix,
        });
        let y = math.evaluate('matrix[:, 4]', {
          matrix,
        });

        let m = y.length;
        let n = X[0].length;

        // Part 1: Cost Function and Gradient
        // Add Intercept Term
        X = math.concat(math.ones([m, 1]).valueOf(), X);

        let theta = Array(n + 1).fill().map(() => [0]);
        let cost = costFunction(theta, X, y);


        // Part 2: Gradient Descent

        const ALPHA = 0.001;
        const ITERATIONS = 500;

        theta = [[0], [0], [0], [0]];
        theta = gradientDescent(X, y, theta, ALPHA, ITERATIONS);

        cost = costFunction(theta, X, y)

        globalTheta = [...theta]
        // Part 3: Predict admission of a student with exam scores 45 and 85

        // let studentVector = [1, 45, 85, 60];
        // let prob = sigmoid(math.evaluate('studentVector * theta', {
        //   studentVector,
        //   theta,
        // }));
      }
      else{
        theta = [[0], [0], [0], [0]];
        globalTheta = [...theta]
      }


    }
    function costFunction(theta, X, y) {

      const m = y.length;
      let h = sigmoid(math.evaluate(`X * theta`, {
        X,
        theta,
      }));
      // array log h
      let logh = []
      let log_h = []
      for (let obj of h) {
        eachh = math.log(obj[0])
        logh.push([eachh])
        each_h = math.log(1 - obj[0])
        log_h.push([each_h])
      }
      // end array log h
      const cost = math.evaluate(`(1/m) * (-y' * logh - (1 - y)' * log_h)`, {
        logh,
        log_h,
        y,
        m,
      });

      return cost;
    }
    function sigmoid(z) {
      let g = math.evaluate(`1 ./ (1 + e.^-z)`, {
        z,
      });

      return g;
    }
    function gradientDescent(X, y, theta, ALPHA, ITERATIONS) {
      const m = y.length;

      for (let i = 0; i < ITERATIONS; i++) {
        let h = sigmoid(math.evaluate(`X * theta`, {
          X,
          theta,
        }));

        theta = math.evaluate(`theta - ALPHA / m * ((h - y)' * X)'`, {
          theta,
          ALPHA,
          m,
          X,
          y,
          h,
        });
      }

      return theta;
    }


    // KNN
    async function buildKNN(currTemp, currHumid, currLight) {
      let history = await fetchStuff(
        `http://localhost:5000/history?username=${username}`
      );
      let distanceArray = []
      for (let his of history) {
        let hisTemp = his.temp
        let hisHumid = his.humid
        let hisLight = his.light
        let dis = math.evaluate(`sqrt((currTemp-hisTemp)^2+(currHumid-hisHumid)^2+(currLight-hisLight)^2)`, { currTemp, currHumid, currLight, hisTemp, hisHumid, hisLight })
        let obj = {
          quality: his.quality,
          distance: dis
        }
        distanceArray.push(obj)
      }
      // console.log(JSON.stringify(distanceArray))
      distanceArray.sort((a, b) => a.distance - b.distance);
      // console.log(JSON.stringify(distanceArray))
      let lim;
      if (distanceArray.length >= 7) {
        lim = 7
      }
      else {
        lim = distanceArray.length
      }
      let countQuality = [0, 0]
      for (let i = 0; i < lim; i++) {
        if (distanceArray[i].quality == "good") {
          countQuality[0] += 1
        }
        if (distanceArray[i].quality == "bad") {
          countQuality[1] += 1
        }
      }
      // document.getElementById("goodCount").innerHTML = countQuality[0]
      // document.getElementById("badCount").innerHTML = countQuality[1]
      if (countQuality[0] > countQuality[1]) {
        document.getElementById("knnPrediction").innerHTML = `<div class="alert alert-light-success color-success">
                                                                <div class="row">
                                                                  <div class="col-2 d-flex flex-column justify-content-center">
                                                                    <i class="bi-check-circle" style="font-size:30px"></i>
                                                                  </div>
                                                                  <div class="col-10 d-flex flex-column justify-content-center">
                                                                    <p>With this environment, you might have a good sleep</p>
                                                                  </div>
                                                                </div>
                                                              </div>`
      }
      else {
        document.getElementById("knnPrediction").innerHTML = `<div class="alert alert-light-warning color-warning">
                                                                <div class="row">
                                                                  <div class="col-2 d-flex flex-column justify-content-center">
                                                                    <i class="bi-exclamation-triangle" style="font-size:30px"></i>
                                                                  </div>
                                                                  <div class="col-10 d-flex flex-column justify-content-center">
                                                                    <p>With this environment, you might have a bad sleep</p>
                                                                  </div>
                                                                </div>
                                                              </div>`
      }
    }

    // Options for charts
    var options = {
      animation: false,
      //Boolean - If we want to override with a hard coded scale
      scaleOverride: true,
      //** Required if scaleOverride is true **
      //Number - The number of steps in a hard coded scale
      scaleSteps: 10,
      //Number - The value jump in the hard coded scale
      scaleStepWidth: 10,
      //Number - The scale starting value
      scaleStartValue: 0,
    };
    // Draw temp chart
    var tempchart = document.getElementById("temp").getContext("2d");
    var tempChartData = {
      labels: [
        currTime,
        currTime,
        currTime,
        currTime,
        currTime,
        currTime,
        currTime,
      ],
      datasets: [
        {
          label: "Current temperature",
          borderColor: "rgb(255, 107, 107, 1)",
          backgroundColor: "rgb(255, 107, 107, 0.2)",
          fillColor: "rgba(220,220,220,0.2)",
          strokeColor: "rgba(220,220,220,1)",
          pointColor: "rgba(220,220,220,1)",
          pointStrokeColor: "#fff",
          pointHighlightFill: "#fff",
          pointHighlightStroke: "rgba(220,220,220,1)",
          data: JSON.parse(sessionStorage.getItem("tempSessionChart")),
        },
      ],
    };
    var tempconfig = new Chart(tempchart, {
      type: "line",
      data: tempChartData,
      options: options,
    });
    // Draw humid chart
    var humidchart = document.getElementById("humid").getContext("2d");
    var humidChartData = {
      labels: [
        currTime,
        currTime,
        currTime,
        currTime,
        currTime,
        currTime,
        currTime,
      ],
      datasets: [
        {
          label: "Current humid",
          borderColor: "rgb(77, 150, 255)",
          backgroundColor: "rgb(77, 150, 255, 0.2)",
          fillColor: "rgba(220,220,220,0.2)",
          strokeColor: "rgba(220,220,220,1)",
          pointColor: "rgba(220,220,220,1)",
          pointStrokeColor: "#fff",
          pointHighlightFill: "#fff",
          pointHighlightStroke: "rgba(220,220,220,1)",
          data: JSON.parse(sessionStorage.getItem("humidSessionChart")),
        },
      ],
    };
    var humidconfig = new Chart(humidchart, {
      type: "line",
      data: humidChartData,
      options: options,
    });
    // Draw light chart
    var lightchart = document.getElementById("light").getContext("2d");
    var lightChartData = {
      labels: [
        currTime,
        currTime,
        currTime,
        currTime,
        currTime,
        currTime,
        currTime,
      ],
      datasets: [
        {
          label: "Current light",
          borderColor: "rgb(255, 217, 61)",
          backgroundColor: "rgb(255, 217, 61, 0.2)",
          fillColor: "rgba(220,220,220,0.2)",
          strokeColor: "rgba(220,220,220,1)",
          pointColor: "rgba(220,220,220,1)",
          pointStrokeColor: "#fff",
          pointHighlightFill: "#fff",
          pointHighlightStroke: "rgba(220,220,220,1)",
          data: JSON.parse(sessionStorage.getItem("lightSessionChart")),
        },
      ],
    };
    var lightconfig = new Chart(lightchart, {
      type: "line",
      data: lightChartData,
      options: options,
    });
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    async function updateSleepRender() {
      let ada = await fetchStuff(
        "https://io.adafruit.com/api/v2/nguyennamkha/feeds"
      );
      // Check sleeping status
      if (sessionStorage.getItem("sleeping") == "no") {
        document.getElementById("sleepSwitch").checked = true;
        let history = await fetchStuff(
          `http://localhost:5000/history?username=${username}`
        );
        // Render last night environment
        if (history.length == 0) {
          document.getElementById("envTitle").innerHTML = `Last night environment`
          document.getElementById("tempRender").innerHTML = `NaN <sup>o</sup>C`
          document.getElementById("humidRender").innerHTML = `NaN %`
          document.getElementById("lightRender").innerHTML = `NaN %`
        }
        else {
          document.getElementById("envTitle").innerHTML = `Last night environment`
          document.getElementById("tempRender").innerHTML = `${history[history.length - 1].temp} <sup>o</sup>C`
          document.getElementById("humidRender").innerHTML = `${history[history.length - 1].humid} %`
          document.getElementById("lightRender").innerHTML = `${history[history.length - 1].light} %`
        }
        if (history.length != 0) {
          if (history[history.length - 1].quality == "na") {
            // If no answer yet
            // document.getElementById("qualityQuestion").style.display = "block";
          }
          if (history[history.length - 1].quality == "good") {
            document.getElementById("qualityQuestion").style.display = "none";
            document.getElementById("qualityRender").innerHTML = `<h5 class="card-title pb-3 pt-4" style="color:green;">You had a good sleep</h5>`;
          }
          if (history[history.length - 1].quality == "bad") {
            document.getElementById("qualityQuestion").style.display = "none";
            document.getElementById("qualityRender").innerHTML = `<h5 class="card-title pb-3 pt-4" style="color:red;">You had a bad sleep</h5>`;
          }
          if (history[history.length - 1].quality == "na") {
            document.getElementById("qualityQuestion").style.display = "block";
            document.getElementById("qualityRender").innerHTML = ``;
          }

        }
      }
      else if (sessionStorage.getItem("sleeping") == "yes") {
        document.getElementById("sleepSwitch").checked = false;
        document.getElementById("envTitle").innerHTML = `Average environment`
        document.getElementById("tempRender").innerHTML = `${sessionStorage.getItem("tempSessionAverage")} <sup>o</sup>C`
        document.getElementById("humidRender").innerHTML = `${sessionStorage.getItem("humidSessionAverage")} %`
        document.getElementById("lightRender").innerHTML = `${sessionStorage.getItem("lightSessionAverage")} %`
        document.getElementById("qualityQuestion").style.display = "none";
        document.getElementById("qualityRender").innerHTML = `<h5 class="card-title pb-3 pt-4" style="color:orange;display:block">You are sleeping!</h5>`;
      }
    }

    async function updateSleepAvg() {
      let ada = await fetchStuff(
        "https://io.adafruit.com/api/v2/nguyennamkha/feeds"
      );
      // Check sleeping status
      if (sessionStorage.getItem("sleeping") == "yes") {
        ///////////////////////////////////////////////////////////////////
        let tempArray = JSON.parse(
          sessionStorage.getItem("tempSessionSleep")
        );
        tempArray.push(
          parseFloat(
            ada.find(
              (obj) => obj.name == sessionStorage.getItem("varSensorTemp")
            ).last_value
          )
        );
        sessionStorage.setItem("tempSessionSleep", JSON.stringify(tempArray));
        ///////////////////////////////////////////////////////////////////
        let humidArray = JSON.parse(
          sessionStorage.getItem("humidSessionSleep")
        );
        humidArray.push(
          parseFloat(
            ada.find(
              (obj) => obj.name == sessionStorage.getItem("varSensorHumid")
            ).last_value
          )
        );
        sessionStorage.setItem(
          "humidSessionSleep",
          JSON.stringify(humidArray)
        );
        ///////////////////////////////////////////////////////////////////
        let lightArray = JSON.parse(
          sessionStorage.getItem("lightSessionSleep")
        );
        lightArray.push(
          parseFloat(
            ada.find(
              (obj) => obj.name == sessionStorage.getItem("varSensorLight")
            ).last_value
          )
        );
        sessionStorage.setItem(
          "lightSessionSleep",
          JSON.stringify(lightArray)
        );
        ///////////////////////////////////////////////////////////////////
        tempAverage = parseFloat(
          tempArray.reduce((a, b) => a + b, 0) / tempArray.length
        ).toFixed(1);
        sessionStorage.setItem("tempSessionAverage", tempAverage);
        humidAverage = parseFloat(
          humidArray.reduce((a, b) => a + b, 0) / humidArray.length
        ).toFixed(1);
        sessionStorage.setItem("humidSessionAverage", humidAverage);
        lightAverage = parseFloat(
          lightArray.reduce((a, b) => a + b, 0) / lightArray.length
        ).toFixed(1);
        sessionStorage.setItem("lightSessionAverage", lightAverage);
        console.clear()
        console.log(
          "tempArray: ",
          JSON.parse(sessionStorage.getItem("tempSessionSleep"))
        );
        console.log(
          "humidArray: ",
          JSON.parse(sessionStorage.getItem("humidSessionSleep"))
        );
        console.log(
          "lightArray: ",
          JSON.parse(sessionStorage.getItem("lightSessionSleep"))
        );

        console.log(
          "tempAverage: ",
          sessionStorage.getItem("tempSessionAverage")
        );
        console.log(
          "humidAverage: ",
          sessionStorage.getItem("humidSessionAverage")
        );
        console.log(
          "lightAverage: ",
          sessionStorage.getItem("lightSessionAverage")
        );
      }
      updateSleepRender();
    }

    async function updateEnv() {
      let ada = await fetchStuff(
        "https://io.adafruit.com/api/v2/nguyennamkha/feeds"
      );
      // Update dumb avg
      if (sessionStorage.getItem("sleeping") == "no") {
        sessionStorage.setItem("tempSessionAverage", ada.find((obj) => obj.name == varSensorTemp).last_value)
        sessionStorage.setItem("humidSessionAverage", ada.find((obj) => obj.name == varSensorHumid).last_value)
        sessionStorage.setItem("lightSessionAverage", ada.find((obj) => obj.name == varSensorLight).last_value)
      }
      // Update current environment
      var newTemp = `<span
                              class="form-control"
                              readonly
                            >
                            ${ada.find((obj) => obj.name == varSensorTemp)
          .last_value
        } <sup>o</sup>C
                            </span>`;
      document.getElementById("currentTemp").innerHTML = newTemp;

      var newHumid = `<span
                              class="form-control"
                              readonly
                            >
                            ${ada.find((obj) => obj.name == varSensorHumid)
          .last_value
        } %
                            </span>`;
      document.getElementById("currentHumid").innerHTML = newHumid;

      var newLight = `<span
                              class="form-control"
                              readonly
                            >
                            ${ada.find((obj) => obj.name == varSensorLight)
          .last_value
        } %
                            </span>`;
      document.getElementById("currentLight").innerHTML = newLight;
      // Update percentage predict
      let currTemp = ada.find((obj) => obj.name == varSensorTemp).last_value
      let currHumid = ada.find((obj) => obj.name == varSensorHumid).last_value
      let currLight = ada.find((obj) => obj.name == varSensorLight).last_value
      let currEnv = [1, currTemp, currHumid, currLight];
      // let prob = sigmoid(math.evaluate('currEnv * globalTheta', {
      //   currEnv,
      //   globalTheta,
      // }));
      // document.getElementById("qualityPercentage").innerHTML = `${parseFloat(prob * 100).toFixed(1)} %`;
      // Update KNN prediction
      await buildKNN(currTemp, currHumid, currLight)
      // Update ideal env
      if (typeof (idealTemp) == "string") {
        document.getElementById("idealTemp").innerHTML = `${idealTemp} <sup>o</sup>C`
        document.getElementById("idealHumid").innerHTML = `${idealHumid} %`
        document.getElementById("idealLight").innerHTML = `${idealLight} %`
      }
      else {
        document.getElementById("idealTemp").innerHTML = `NaN <sup>o</sup>C`
        document.getElementById("idealHumid").innerHTML = `NaN %`
        document.getElementById("idealLight").innerHTML = `NaN %`
      }
      // Update new chart data
      setData(
        tempChartData.datasets[0].data,
        parseFloat(ada.find((obj) => obj.name == varSensorTemp).last_value),
        "temp"
      );
      setLabels(tempChartData.labels);
      setData(
        humidChartData.datasets[0].data,
        parseFloat(ada.find((obj) => obj.name == varSensorHumid).last_value),
        "humid"
      );
      setLabels(humidChartData.labels);
      setData(
        lightChartData.datasets[0].data,
        parseFloat(ada.find((obj) => obj.name == varSensorLight).last_value),
        "light"
      );
      setLabels(lightChartData.labels);
      // Draw new charts
      tempconfig.destroy();
      tempconfig = new Chart(tempchart, {
        type: "line",
        data: tempChartData,
        options: options,
      });
      humidconfig.destroy();
      humidconfig = new Chart(humidchart, {
        type: "line",
        data: humidChartData,
        options: options,
      });
      lightconfig.destroy();
      lightconfig = new Chart(lightchart, {
        type: "line",
        data: lightChartData,
        options: options,
      });
    }

    async function updateDevice() {
      fetchStuff("https://io.adafruit.com/api/v2/nguyennamkha/feeds").then(
        (ada) => {
          // Update Fan mode
          if (
            ada.find((obj) => obj.name == varMode).last_value == "AUTO" &&
            sessionStorage.getItem("fetching") == "no"
          ) {
            document.getElementById("fanMode").checked = true;
            document.getElementById("fanSliderBox").style.display = "none";
          }
          if (
            ada.find((obj) => obj.name == varMode).last_value == "MANU" &&
            sessionStorage.getItem("fetching") == "no"
          ) {
            document.getElementById("fanMode").checked = false;
            document.getElementById("fanSliderBox").style.display =
              "inline-block";
            ("inline-block");
          }
          // Update Fan slider value
          if (sessionStorage.getItem("fetching") == "no") {
            document.getElementById("fanSliderValue").value = parseInt(
              ada.find((obj) => obj.name == varDeviceFan).last_value
            );
          }
          // Dumb function start
          function updateDonut(percent, element) {
            //var percent = 45;
            if (percent < 50) {
              offset = (360 / 100) * percent;
              element.parentNode.querySelector(
                "#section3"
              ).style.webkitTransform = "rotate(" + offset + "deg)";
              element.parentNode.querySelector(
                "#section3 .item"
              ).style.webkitTransform = "rotate(" + (180 - offset) + "deg)";
              element.parentNode.querySelector(
                "#section3"
              ).style.msTransform = "rotate(" + offset + "deg)";
              element.parentNode.querySelector(
                "#section3 .item"
              ).style.msTransform = "rotate(" + (180 - offset) + "deg)";
              element.parentNode.querySelector(
                "#section3"
              ).style.MozTransform = "rotate(" + offset + "deg)";
              element.parentNode.querySelector(
                "#section3 .item"
              ).style.MozTransform = "rotate(" + (180 - offset) + "deg)";
              element.parentNode.querySelector(
                "#section3 .item"
              ).style.backgroundColor = "#E64C65";
            } else {
              offset = (360 / 100) * percent - 180;
              element.parentNode.querySelector(
                "#section3"
              ).style.webkitTransform = "rotate(180deg)";
              element.parentNode.querySelector(
                "#section3 .item"
              ).style.webkitTransform = "rotate(" + offset + "deg)";
              element.parentNode.querySelector(
                "#section3"
              ).style.msTransform = "rotate(180deg)";
              element.parentNode.querySelector(
                "#section3 .item"
              ).style.msTransform = "rotate(" + offset + "deg)";
              element.parentNode.querySelector(
                "#section3"
              ).style.MozTransform = "rotate(180deg)";
              element.parentNode.querySelector(
                "#section3 .item"
              ).style.MozTransform = "rotate(" + offset + "deg)";
              element.parentNode.querySelector(
                "#section3 .item"
              ).style.backgroundColor = "#41A8AB";
            }
            element.parentNode.querySelector("span").innerHTML =
              percent + "%";
          }

          function updateSlider(element) {
            if (element) {
              var parent = element.parentElement;
              var thumb = parent.querySelector(".range-slider__thumb"),
                bar = parent.querySelector(".range-slider__bar"),
                pct =
                  element.value *
                  ((parent.clientHeight - thumb.clientHeight) /
                    parent.clientHeight);
              thumb.style.bottom = pct + "%";
              bar.style.height =
                "calc(" + pct + "% + " + thumb.clientHeight / 2 + "px)";
              thumb.textContent = element.value + "%";
            }
            updateDonut(element.value, element.parentNode);
          }
          (function initAndSetupTheSliders() {
            [].forEach.call(
              document.getElementsByClassName("container"),
              function (el) {
                var inputs = [].slice.call(
                  el.querySelectorAll(".range-slider input")
                );
                inputs.forEach(function (input) {
                  input.setAttribute("value", "50");
                  updateSlider(input);
                  input.addEventListener("input", function (element) {
                    updateSlider(input);
                  });
                  input.addEventListener("change", function (element) {
                    updateSlider(input);
                  });
                });
              }
            );
          })();
          // Dumb function end
          // Update LED
          if (
            ada.find((obj) => obj.name == varDeviceLed).last_value == "ON" &&
            sessionStorage.getItem("fetching") == "no"
          ) {
            document.getElementById("ledSwitch").checked = true;
          }
          if (
            ada.find((obj) => obj.name == varDeviceLed).last_value == "OFF" &&
            sessionStorage.getItem("fetching") == "no"
          ) {
            document.getElementById("ledSwitch").checked = false;
          }
        }
      );
    }

    // Go to sleep
    document
      .getElementById("sleepSwitch")
      .addEventListener("click", toggleSleepWake);
    async function toggleSleepWake(a) {
      if (a.target.checked == false) {
        sessionStorage.setItem("sleeping", "yes");
        document.getElementById("envTitle").innerHTML = `Average environment`
        document.getElementById("qualityQuestion").style.display = "none";
        document.getElementById("qualityRender").innerHTML = `<h5 class="card-title pb-3 pt-4" style="color:orange;display:block">You are sleeping!</h5>`;
        // Start counting time
        sleepT = new Date();
        sleepT = sleepT.toLocaleString();
        sessionStorage.setItem("sleepTime", sleepT);
        updateSleepRender();
      } else if (a.target.checked == true) {
        sessionStorage.setItem("sleeping", "no");
        document.getElementById("envTitle").innerHTML = `Last night environment`
        document.getElementById("qualityQuestion").style.display = "block";
        document.getElementById("qualityRender").innerHTML = ``;
        // Update database
        wakeT = new Date();
        wakeT = wakeT.toLocaleString();
        let newHis = {
          sleepTime: sessionStorage.getItem("sleepTime"),
          wakeTime: wakeT,
          temp: parseFloat(sessionStorage.getItem("tempSessionAverage")),
          humid: parseFloat(sessionStorage.getItem("humidSessionAverage")),
          light: parseFloat(sessionStorage.getItem("lightSessionAverage")),
          quality: "na",
          username: sessionStorage.getItem("username"),
        };
        await postpatchData("http://localhost:5000/history", newHis, "POST");
        // sessionStorage.setItem("tempSessionAverage", "-1");
        // sessionStorage.setItem("humidSessionAverage", "-1");
        // sessionStorage.setItem("lightSessionAverage", "-1");
        // sessionStorage.setItem("sleepTime", "-1");
        sessionStorage.setItem("tempSessionSleep", JSON.stringify([]));
        sessionStorage.setItem("humidSessionSleep", JSON.stringify([]));
        sessionStorage.setItem("lightSessionSleep", JSON.stringify([]));
        updateSleepRender();
      }
    }
    // Get answer yes no
    document.getElementById("submitYesNo").addEventListener("click", handleSubmit);
    async function handleSubmit(a) {
      let sleepQuality = "na"
      if (document.getElementById("sleepYes").checked == true) {
        sleepQuality = "good"
      }
      else if (document.getElementById("sleepNo").checked == true) {
        sleepQuality = "bad"
      }
      if ((document.getElementById("sleepYes").checked != false) || (document.getElementById("sleepNo").checked != false)) {
        document.getElementById("loading").style.display = "flex"
        let history = await fetchStuff(`http://localhost:5000/history?username=${username}`);
        let patchId = history[history.length - 1].id;
        let newObj = {
          quality: sleepQuality
        }
        await postpatchData(`http://localhost:5000/history/${patchId}`, newObj, "PATCH")
        await updateSleepRender()
        document.getElementById("loading").style.display = "none"
        await buildLogistic()
        await updateEnv()
      }
    }
    // Send LED
    document.getElementById("ledSwitch").addEventListener("click", turnLight);
    async function turnLight(a) {
      sessionStorage.setItem("fetching", "yes");
      document.getElementById("loading").style.display = "flex";
      let newObj = {};
      if (a.target.checked == true) {
        newObj = { value: "ON" };
      } else {
        newObj = { value: "OFF" };
      }
      await postpatchData(
        "https://io.adafruit.com/api/v2/nguyennamkha/feeds/device-light/data",
        newObj,
        "POST"
      );
      document.getElementById("loading").style.display = "none";
      sessionStorage.setItem("fetching", "no");
    }
    // Send Mode
    document.getElementById("fanMode").addEventListener("click", changeMode);
    async function changeMode(a) {
      sessionStorage.setItem("fetching", "yes");
      document.getElementById("loading").style.display = "flex";
      // start
      let newObj = {};
      if (a.target.checked == true) {
        newObj = { value: "AUTO" };
      } else {
        newObj = { value: "MANU" };
      }
      await postpatchData(
        "https://io.adafruit.com/api/v2/nguyennamkha/feeds/mode/data",
        newObj,
        "POST"
      );
      // end
      document.getElementById("loading").style.display = "none";
      sessionStorage.setItem("fetching", "no");
      updateDevice()
    }
    // Send fan value
    document.getElementById("fanSliderValue").addEventListener("click", changeFanSpeed);
    async function changeFanSpeed(a) {
      sessionStorage.setItem("fetching", "yes");
      document.getElementById("loading").style.display = "flex";
      // start
      let newObj = { value: a.target.value };
      await postpatchData(
        "https://io.adafruit.com/api/v2/nguyennamkha/feeds/device-fan/data",
        newObj,
        "POST"
      );
      // end
      document.getElementById("loading").style.display = "none";
      sessionStorage.setItem("fetching", "no");
    }

    document.getElementById("fanSliderValue").addEventListener("input", function (e) {
      sessionStorage.setItem("fetching", "yes");
    });
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // Loop
    buildLogistic();
    updateSleepRender();
    setInterval(updateSleepAvg, 10000);
    updateEnv();
    setInterval(updateEnv, 10000);
    updateDevice();
    setInterval(updateDevice, 1000);
  </script>
  <script src="assets/static/js/components/dark.js"></script>
  <script src="assets/extensions/perfect-scrollbar/perfect-scrollbar.min.js"></script>
  <script src="assets/static/js/pages/fan.js"></script>
  <script src="assets/static/js/pages/clock.js"></script>

  <script src="assets/compiled/js/app.js"></script>
</body>

</html>