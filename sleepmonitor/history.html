<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>History</title>

  <link rel="shortcut icon" href="./assets/compiled/svg/favicon.svg" type="image/x-icon" />
  <link rel="shortcut icon"
    href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACEAAAAiCAYAAADRcLDBAAAEs2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgZXhpZjpQaXhlbFhEaW1lbnNpb249IjMzIgogICBleGlmOlBpeGVsWURpbWVuc2lvbj0iMzQiCiAgIGV4aWY6Q29sb3JTcGFjZT0iMSIKICAgdGlmZjpJbWFnZVdpZHRoPSIzMyIKICAgdGlmZjpJbWFnZUxlbmd0aD0iMzQiCiAgIHRpZmY6UmVzb2x1dGlvblVuaXQ9IjIiCiAgIHRpZmY6WFJlc29sdXRpb249Ijk2LjAiCiAgIHRpZmY6WVJlc29sdXRpb249Ijk2LjAiCiAgIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiCiAgIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjItMDMtMzFUMTA6NTA6MjMrMDI6MDAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjItMDMtMzFUMTA6NTA6MjMrMDI6MDAiPgogICA8eG1wTU06SGlzdG9yeT4KICAgIDxyZGY6U2VxPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJwcm9kdWNlZCIKICAgICAgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWZmaW5pdHkgRGVzaWduZXIgMS4xMC4xIgogICAgICBzdEV2dDp3aGVuPSIyMDIyLTAzLTMxVDEwOjUwOjIzKzAyOjAwIi8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9InIiPz5V57uAAAABgmlDQ1BzUkdCIElFQzYxOTY2LTIuMQAAKJF1kc8rRFEUxz9maORHo1hYKC9hISNGTWwsRn4VFmOUX5uZZ36oeTOv954kW2WrKLHxa8FfwFZZK0WkZClrYoOe87ypmWTO7dzzud97z+nec8ETzaiaWd4NWtYyIiNhZWZ2TvE946WZSjqoj6mmPjE1HKWkfdxR5sSbgFOr9Ll/rXoxYapQVik8oOqGJTwqPL5i6Q5vCzeo6dii8KlwpyEXFL519LjLLw6nXP5y2IhGBsFTJ6ykijhexGra0ITl5bRqmWU1fx/nJTWJ7PSUxBbxJkwijBBGYYwhBgnRQ7/MIQIE6ZIVJfK7f/MnyUmuKrPOKgZLpEhj0SnqslRPSEyKnpCRYdXp/9++msneoFu9JgwVT7b91ga+LfjetO3PQ9v+PgLvI1xkC/m5A+h7F32zoLXug38dzi4LWnwHzjeg8UGPGbFfySvuSSbh9QRqZ6H+Gqrm3Z7l9zm+h+iafNUV7O5Bu5z3L/wAdthn7QIme0YAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAJTSURBVFiF7Zi9axRBGIefEw2IdxFBRQsLWUTBaywSK4ubdSGVIY1Y6HZql8ZKCGIqwX/AYLmCgVQKfiDn7jZeEQMWfsSAHAiKqPiB5mIgELWYOW5vzc3O7niHhT/YZvY37/swM/vOzJbIqVq9uQ04CYwCI8AhYAlYAB4Dc7HnrOSJWcoJcBS4ARzQ2F4BZ2LPmTeNuykHwEWgkQGAet9QfiMZjUSt3hwD7psGTWgs9pwH1hC1enMYeA7sKwDxBqjGnvNdZzKZjqmCAKh+U1kmEwi3IEBbIsugnY5avTkEtIAtFhBrQCX2nLVehqyRqFoCAAwBh3WGLAhbgCRIYYinwLolwLqKUwwi9pxV4KUlxKKKUwxC6ZElRCPLYAJxGfhSEOCz6m8HEXvOB2CyIMSk6m8HoXQTmMkJcA2YNTHm3congOvATo3tE3A29pxbpnFzQSiQPcB55IFmFNgFfEQeahaAGZMpsIJIAZWAHcDX2HN+2cT6r39GxmvC9aPNwH5gO1BOPFuBVWAZue0vA9+A12EgjPadnhCuH1WAE8ivYAQ4ohKaagV4gvxi5oG7YSA2vApsCOH60WngKrA3R9IsvQUuhIGY00K4flQG7gHH/mLytB4C42EgfrQb0mV7us8AAMeBS8mGNMR4nwHamtBB7B4QRNdaS0M8GxDEog7iyoAguvJ0QYSBuAOcAt71Kfl7wA8DcTvZ2KtOlJEr+ByyQtqqhTyHTIeB+ONeqi3brh+VgIN0fohUgWGggizZFTplu12yW8iy/YLOGWMpDMTPXnl+Az9vj2HERYqPAAAAAElFTkSuQmCC"
    type="image/png" />
  <link rel="stylesheet" href="assets/extensions/simple-datatables/style.css" />
  <link rel="stylesheet" href="./assets/compiled/css/table-datatable.css" />
  <link rel="stylesheet" href="./assets/compiled/css/app.css" />
  <link rel="stylesheet" href="./assets/compiled/css/app-dark.css" />
  <link rel="stylesheet" href="./assets/compiled/css/iconly.css" />
</head>

<body>
  <script src="assets/static/js/initTheme.js"></script>
  <div id="app">
    <div id="sidebar">
      <div class="sidebar-wrapper active">
        <div class="sidebar-header position-relative">
          <div class="d-flex justify-content-between align-items-center">
            <div class="logo">
              <a href="dashboard.html" style="font-size: 1.3rem">sleep monitor</a>
            </div>
            <div class="theme-toggle d-flex gap-2 align-items-center mt-2">
              <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true"
                role="img" class="iconify iconify--system-uicons" width="20" height="20"
                preserveAspectRatio="xMidYMid meet" viewBox="0 0 21 21">
                <g fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                  <path
                    d="M10.5 14.5c2.219 0 4-1.763 4-3.982a4.003 4.003 0 0 0-4-4.018c-2.219 0-4 1.781-4 4c0 2.219 1.781 4 4 4zM4.136 4.136L5.55 5.55m9.9 9.9l1.414 1.414M1.5 10.5h2m14 0h2M4.135 16.863L5.55 15.45m9.899-9.9l1.414-1.415M10.5 19.5v-2m0-14v-2"
                    opacity=".3"></path>
                  <g transform="translate(-210 -1)">
                    <path d="M220.5 2.5v2m6.5.5l-1.5 1.5"></path>
                    <circle cx="220.5" cy="11.5" r="4"></circle>
                    <path d="m214 5l1.5 1.5m5 14v-2m6.5-.5l-1.5-1.5M214 18l1.5-1.5m-4-5h2m14 0h2"></path>
                  </g>
                </g>
              </svg>
              <div class="form-check form-switch fs-6">
                <input class="form-check-input me-0" type="checkbox" id="toggle-dark" style="cursor: pointer" />
                <label class="form-check-label"></label>
              </div>
              <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true"
                role="img" class="iconify iconify--mdi" width="20" height="20" preserveAspectRatio="xMidYMid meet"
                viewBox="0 0 24 24">
                <path fill="currentColor"
                  d="m17.75 4.09l-2.53 1.94l.91 3.06l-2.63-1.81l-2.63 1.81l.91-3.06l-2.53-1.94L12.44 4l1.06-3l1.06 3l3.19.09m3.5 6.91l-1.64 1.25l.59 1.98l-1.7-1.17l-1.7 1.17l.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95l2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85c-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14c.4-.4.82-.76 1.27-1.08c.75-.53 1.93.36 1.85 1.19c-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82c-2.81 3.14-2.7 7.96.31 10.98c3.02 3.01 7.84 3.12 10.98.31Z">
                </path>
              </svg>
            </div>
            <div class="sidebar-toggler x">
              <a href="#" class="sidebar-hide d-xl-none d-block"><i class="bi bi-x bi-middle"></i></a>
            </div>
          </div>
        </div>
        <div class="sidebar-menu">
          <ul class="menu">
            <li class="sidebar-title">Menu</li>

            <li class="sidebar-item">
              <a href="dashboard.html" class="sidebar-link">
                <i class="bi bi-grid-fill"></i>
                <span>Dashboard</span>
              </a>
            </li>
            <li class="sidebar-item active">
              <a href="history.html" class="sidebar-link">
                <i class="bi bi-calendar-week-fill"></i>
                <span>History</span>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div id="main" class="layout-navbar navbar-fixed">
      <header>
        <nav class="navbar navbar-expand navbar-light navbar-top">
          <div class="container-fluid">
            <a href="#" class="burger-btn d-block">
              <i class="bi bi-justify fs-3"></i>
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
              data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
              aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
              <ul class="navbar-nav ms-auto mb-lg-0">
                <!-- <li class="nav-item dropdown me-1">
                    <a
                      class="nav-link active dropdown-toggle text-gray-600"
                      href="#"
                      data-bs-toggle="dropdown"
                      aria-expanded="false"
                    >
                      <i class="bi bi-envelope bi-sub fs-4"></i>
                    </a>
                    <ul
                      class="dropdown-menu dropdown-menu-end"
                      aria-labelledby="dropdownMenuButton"
                    >
                      <li>
                        <h6 class="dropdown-header">Mail</h6>
                      </li>
                      <li><a class="dropdown-item" href="#">No new mail</a></li>
                    </ul>
                  </li>
                  <li class="nav-item dropdown me-3">
                    <a
                      class="nav-link active dropdown-toggle text-gray-600"
                      href="#"
                      data-bs-toggle="dropdown"
                      data-bs-display="static"
                      aria-expanded="false"
                    >
                      <i class="bi bi-bell bi-sub fs-4"></i>
                      <span class="badge badge-notification bg-danger">7</span>
                    </a>
                    <ul
                      class="dropdown-menu dropdown-menu-end notification-dropdown"
                      aria-labelledby="dropdownMenuButton"
                    >
                      <li class="dropdown-header">
                        <h6>Notifications</h6>
                      </li>
                      <li class="dropdown-item notification-item">
                        <a class="d-flex align-items-center" href="#">
                          <div class="notification-icon bg-primary">
                            <i class="bi bi-cart-check"></i>
                          </div>
                          <div class="notification-text ms-4">
                            <p class="notification-title font-bold">
                              Successfully check out
                            </p>
                            <p class="notification-subtitle font-thin text-sm">
                              Order ID #256
                            </p>
                          </div>
                        </a>
                      </li>
                      <li class="dropdown-item notification-item">
                        <a class="d-flex align-items-center" href="#">
                          <div class="notification-icon bg-success">
                            <i class="bi bi-file-earmark-check"></i>
                          </div>
                          <div class="notification-text ms-4">
                            <p class="notification-title font-bold">
                              Homework submitted
                            </p>
                            <p class="notification-subtitle font-thin text-sm">
                              Algebra math homework
                            </p>
                          </div>
                        </a>
                      </li>
                      <li>
                        <p class="text-center py-2 mb-0">
                          <a href="#">See all notification</a>
                        </p>
                      </li>
                    </ul>
                  </li> -->
              </ul>
              <div class="dropdown">
                <a href="#" data-bs-toggle="dropdown" aria-expanded="false">
                  <div class="user-menu d-flex align-items-center">
                    <div class="user-name text-end me-3">
                      <h6 class="text-gray-600 mb-0" id="loginName"></h6>
                      <!-- <p class="mb-0 text-sm text-gray-600">Administrator</p> -->
                    </div>
                    <div class="user-img d-flex align-items-center">
                      <div class="avatar avatar-md">
                        <img src="./assets/compiled/jpg/1.jpg" />
                      </div>
                    </div>
                  </div>
                </a>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton"
                  style="min-width: 11rem">
                  <li>
                    <h6 class="dropdown-header">Hello, <span id="helloName"></span>!</h6>
                  </li>
                  <li>
                    <a class="dropdown-item" href="login.html"><i class="icon-mid bi bi-box-arrow-left me-2"></i>
                      Logout</a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </nav>
      </header>
      <div id="main-content">
        <div class="page-heading">
          <div class="page-title">
            <div class="row">
              <div class="col-12 col-md-6 order-md-1 order-last">
                <h3>History log</h3>
                <!-- <p class="text-subtitle text-muted">
                    Navbar will appear on the top of the page.
                  </p> -->
              </div>
              <!-- <div class="col-12 col-md-6 order-md-2 order-first">
                  <nav
                    aria-label="breadcrumb"
                    class="breadcrumb-header float-start float-lg-end"
                  >
                    <ol class="breadcrumb">
                      <li class="breadcrumb-item">
                        <a href="index.html">Dashboard</a>
                      </li>
                      <li class="breadcrumb-item active" aria-current="page">
                        Layout Vertical Navbar
                      </li>
                    </ol>
                  </nav>
                </div> -->
            </div>
          </div>
        </div>
        <div class="page-content">
          <section class="section">
            <div class="row">
              <div class="col-12 mb-4">
                <div class="card border border-dark h-100">
                  <div class="card-body">
                    <table class="table table-striped" id="table1">
                      <thead>
                        <tr>
                          <th>Sleep time</th>
                          <th>Wake up time</th>
                          <th>Temperature</th>
                          <th>Humidity</th>
                          <th>Light</th>
                          <th>Sleep quality</th>
                        </tr>
                      </thead>
                      <tbody id="tbl"></tbody>
                    </table>
                  </div>
                </div>
              </div>
              <div class="col-md-2 mb-4">
                <div class="card border border-dark h-100">
                  <div class="card-header pb-0">
                    <h4 class="card-title">Sleep Quality Chart</h4>
                  </div>
                  <div class="card-body d-flex flex-column justify-content-evenly" style="height:50px">
                    <div class="pieChartBox d-flex justify-content-center">
                      <canvas id="sleepPieChart"></canvas>
                    </div>
                    <div class="row">
                      <div class="col-5 d-flex justify-content-end">
                        <div class="stats-icon mb-2" style="background-color: #6BCB77;">
                          <i class="bi-emoji-smile"></i>
                        </div>
                      </div>
                      <div class="col-7">
                        <h6 class="text-muted font-semibold">Good sleep</h6>
                        <h6 class="font-extrabold mb-0" id="goodSleepCount"></h6>
                      </div>
                      <div class="col-5 d-flex justify-content-end">
                        <div class="stats-icon mb-2" style="background-color: #FF6B6B;">
                          <i class="bi-emoji-frown"></i>
                        </div>
                      </div>
                      <div class="col-7">
                        <h6 class="text-muted font-semibold">Bad sleep</h6>
                        <h6 class="font-extrabold mb-0" id="badSleepCount"></h6>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-5 mb-4">
                <div class="card border border-dark h-100">
                  <div class="card-header">
                    <h4 class="card-title">Scatter</h4>
                  </div>
                  <div class="card-body">
                    <div id="scatterChart" style="height:300px"></div>
                  </div>
                </div>
              </div>
              <div class="col-md-5 mb-4">
                <div class="card border border-dark h-100">
                  <div class="card-header">
                    <h4 class="card-title">Last 10 days humid-light</h4>
                  </div>
                  <div class="card-body">
                    <canvas id="envLastChart"></canvas>
                  </div>
                </div>
              </div>
              <div class="col-md-4 mb-4">
                <div class="card border border-dark h-100">
                  <div class="card-header">
                    <h4 class="card-title">Temperature Histogram</h4>
                  </div>
                  <div class="card-body">
                    <canvas id="tempHistogramChart"></canvas>
                  </div>
                </div>
              </div>
              <div class="col-md-4 mb-4">
                <div class="card border border-dark h-100">
                  <div class="card-header">
                    <h4 class="card-title">Humidity Histogram</h4>
                  </div>
                  <div class="card-body">
                    <canvas id="humidHistogramChart"></canvas>
                  </div>
                </div>
              </div>
              <div class="col-md-4 mb-4">
                <div class="card border border-dark h-100">
                  <div class="card-header">
                    <h4 class="card-title">Light Histogram</h4>
                  </div>
                  <div class="card-body">
                    <canvas id="lightHistogramChart"></canvas>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>
      </div>
      <footer>
        <!-- <div class="footer clearfix mb-0 text-muted">
            <div class="float-start">
              <p>2023 &copy; Mazer</p>
            </div>
            <div class="float-end">
              <p>
                Crafted with
                <span class="text-danger"
                  ><i class="bi bi-heart-fill icon-mid"></i
                ></span>
                by <a href="https://saugi.me">Saugi</a>
              </p>
            </div>
          </div> -->
      </footer>
    </div>
  </div>
  <script src="assets/extensions/chart.js/chart.umd.js"></script>
  <!-- Plotly.js -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script>
    // some var
    let username = sessionStorage.getItem("username");
    let aiokey = "aio_BrUo26TdZK5ysTfwZ1lpn2GgFGgI";
    let varDeviceFan = "device_fan";
    let varDeviceLed = "device_light";
    let varMode = "mode";
    let varSensorHumid = "sensor_humid";
    let varSensorLight = "sensor_light";
    let varSensorTemp = "sensor_temp";
    let tempHistogramArray = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
    let humidHistogramArray = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
    let lightHistogramArray = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
    let tempLastArray = []
    let humidLastArray = []
    let lightLastArray = []
    let dayLastArray = []
    let sleepPieArray = [0, 0]
    let tempGoodArray = []
    let humidGoodArray = []
    let lightGoodArray = []
    let tempBadArray = []
    let humidBadArray = []
    let lightBadArray = []
    var currTime = new Date();
    currTime = currTime.toLocaleTimeString();
    document.getElementById("loginName").innerHTML = username
    document.getElementById("helloName").innerHTML = username
    // some functions
    async function fetchStuff(str) {
      const response = await fetch(str);
      const data = await response.json();
      return data;
    }
    async function postpatchData(url = "", data = {}, apiMethod) {
      // Default options are marked with *
      const response = await fetch(url, {
        method: apiMethod, // *GET, POST, PUT, DELETE, etc.
        mode: "cors", // no-cors, *cors, same-origin
        cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
        credentials: "same-origin", // include, *same-origin, omit
        headers: {
          "Content-Type": "application/json",
          "X-AIO-Key": aiokey,
          // 'Content-Type': 'application/x-www-form-urlencoded',
        },
        redirect: "follow", // manual, *follow, error
        referrerPolicy: "no-referrer", // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
        body: JSON.stringify(data), // body data type must match "Content-Type" header
      });
      return response.json(); // parses JSON response into native JavaScript objects
    }
    // datatable
    async function addTableData() {
      let history = await fetchStuff(`http://localhost:5000/history?username=${username}`);
      for (let i = history.length - 1; i >= 0; i--) {
        let x = ``
        if (history[i].quality == "good") {
          x = `<span class="badge bg-success">Good</span>`
        }
        else if (history[i].quality == "bad") {
          x = `<span class="badge bg-danger">Bad</span>`
        }
        else {
          x = `<span class="badge bg-warning">NA</span>`
        }
        let newHis = `<tr>
                <td>${history[i].sleepTime}</td>
                <td>${history[i].wakeTime}</td>
                <td>${history[i].temp} <sup>o</sup>C</td>
                <td>${history[i].humid} %</td>
                <td>${history[i].light} %</td>
                <td>
                  ${x}
                </td>
              </tr>`
        var div = document.createElement("template");
        div.innerHTML = newHis;
        newHis = div.content.firstElementChild;
        document.getElementById("tbl").appendChild(newHis)

      }

    }
    async function updateTable() {
      await addTableData()

      // const script1 = document.createElement("script");
      // script1.src = "assets/extensions/simple-datatables/umd/simple-datatables.js";
      // await document.body.appendChild(script1);

      const script2 = document.createElement("script");
      script2.src = "assets/static/js/pages/simple-datatables.js";
      document.body.appendChild(script2);
    }
    updateTable()
    //////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // Draw chart
    async function drawChart() {
      let history = await fetchStuff(`http://localhost:5000/history?username=${username}`);
      for (let i = 0; i < history.length; i++) {
        // Add to pie chart
        if (history[i].quality == "good") {
          sleepPieArray[0] = sleepPieArray[0] + 1
        }
        else if (history[i].quality == "bad") {
          sleepPieArray[1] = sleepPieArray[1] + 1
        }
        // Add to temp last chart
        if (i >= history.length - 10) {
          tempLastArray.push(history[i].temp)
          humidLastArray.push(history[i].humid)
          lightLastArray.push(history[i].light)
          dayLastArray.push(history[i].sleepTime)
        }
        // Add to temperature histogram array
        if (history[i].quality == "good") {
          if (history[i].temp >= 20.0 && history[i].temp < 21.0) {
            tempHistogramArray[0] = tempHistogramArray[0] + 1
          }
          else if (history[i].temp >= 21.0 && history[i].temp < 22.0) {
            tempHistogramArray[1] = tempHistogramArray[1] + 1
          }
          else if (history[i].temp >= 22.0 && history[i].temp < 23.0) {
            tempHistogramArray[2] = tempHistogramArray[2] + 1
          }
          else if (history[i].temp >= 23.0 && history[i].temp < 24.0) {
            tempHistogramArray[3] = tempHistogramArray[3] + 1
          }
          else if (history[i].temp >= 24.0 && history[i].temp < 25.0) {
            tempHistogramArray[4] = tempHistogramArray[4] + 1
          }
          else if (history[i].temp >= 25.0 && history[i].temp < 26.0) {
            tempHistogramArray[5] = tempHistogramArray[5] + 1
          }
          else if (history[i].temp >= 26.0 && history[i].temp < 27.0) {
            tempHistogramArray[6] = tempHistogramArray[6] + 1
          }
          else if (history[i].temp >= 27.0 && history[i].temp < 28.0) {
            tempHistogramArray[7] = tempHistogramArray[7] + 1
          }
          else if (history[i].temp >= 28.0 && history[i].temp < 29.0) {
            tempHistogramArray[8] = tempHistogramArray[8] + 1
          }
          else if (history[i].temp >= 29.0 && history[i].temp <= 30.0) {
            tempHistogramArray[9] = tempHistogramArray[9] + 1
          }
        }
        // Add to humid histogram array
        if (history[i].quality == "good") {
          if (history[i].humid >= 0 && history[i].humid < 10) {
            humidHistogramArray[0] = humidHistogramArray[0] + 1
          }
          else if (history[i].humid >= 10 && history[i].humid < 20) {
            humidHistogramArray[1] = humidHistogramArray[1] + 1
          }
          else if (history[i].humid >= 20 && history[i].humid < 30) {
            humidHistogramArray[2] = humidHistogramArray[2] + 1
          }
          else if (history[i].humid >= 30 && history[i].humid < 40) {
            humidHistogramArray[3] = humidHistogramArray[3] + 1
          }
          else if (history[i].humid >= 40 && history[i].humid < 50) {
            humidHistogramArray[4] = humidHistogramArray[4] + 1
          }
          else if (history[i].humid >= 50 && history[i].humid < 60) {
            humidHistogramArray[5] = humidHistogramArray[5] + 1
          }
          else if (history[i].humid >= 60 && history[i].humid < 70) {
            humidHistogramArray[6] = humidHistogramArray[6] + 1
          }
          else if (history[i].humid >= 70 && history[i].humid < 80) {
            humidHistogramArray[7] = humidHistogramArray[7] + 1
          }
          else if (history[i].humid >= 80 && history[i].humid < 90) {
            humidHistogramArray[8] = humidHistogramArray[8] + 1
          }
          else if (history[i].humid >= 90 && history[i].humid <= 100) {
            humidHistogramArray[9] = humidHistogramArray[9] + 1
          }


        }
        // Add to light histogram array
        if (history[i].quality == "good") {
          if (history[i].light >= 0 && history[i].light < 10) {
            lightHistogramArray[0] = lightHistogramArray[0] + 1
          }
          else if (history[i].light >= 10 && history[i].light < 20) {
            lightHistogramArray[1] = lightHistogramArray[1] + 1
          }
          else if (history[i].light >= 20 && history[i].light < 30) {
            lightHistogramArray[2] = lightHistogramArray[2] + 1
          }
          else if (history[i].light >= 30 && history[i].light < 40) {
            lightHistogramArray[3] = lightHistogramArray[3] + 1
          }
          else if (history[i].light >= 40 && history[i].light < 50) {
            lightHistogramArray[4] = lightHistogramArray[4] + 1
          }
          else if (history[i].light >= 50 && history[i].light < 60) {
            lightHistogramArray[5] = lightHistogramArray[5] + 1
          }
          else if (history[i].light >= 60 && history[i].light < 70) {
            lightHistogramArray[6] = lightHistogramArray[6] + 1
          }
          else if (history[i].light >= 70 && history[i].light < 80) {
            lightHistogramArray[7] = lightHistogramArray[7] + 1
          }
          else if (history[i].light >= 80 && history[i].light < 90) {
            lightHistogramArray[8] = lightHistogramArray[8] + 1
          }
          else if (history[i].light >= 90 && history[i].light <= 100) {
            lightHistogramArray[9] = lightHistogramArray[9] + 1
          }


        }
        // Add to good array
        if (history[i].quality == "good") {
          tempGoodArray.push(history[i].temp)
          humidGoodArray.push(history[i].humid)
          lightGoodArray.push(history[i].light)
        }
        // Add to bad array
        if (history[i].quality == "bad") {
          tempBadArray.push(history[i].temp)
          humidBadArray.push(history[i].humid)
          lightBadArray.push(history[i].light)
        }
      }
      console.log(JSON.stringify())
      // Draw sleep pie
      const sleepPie = document.getElementById('sleepPieChart').getContext('2d');
      const sleepPieConfig = new Chart(sleepPie, {
        type: 'pie',
        data: {
          datasets: [
            {
              label: 'Number of days',
              data: sleepPieArray,
              backgroundColor: ['rgb(107, 203, 119)', 'rgb(255, 107, 107)'],
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'top',
            }
          }
        },
      })
      document.getElementById("goodSleepCount").innerHTML = sleepPieArray[0]
      document.getElementById("badSleepCount").innerHTML = sleepPieArray[1]
      // Draw temp-humid-light last line chart
      const envLine = document.getElementById('envLastChart').getContext('2d');
      const envLineConfig = new Chart(envLine, {
        type: 'line',
        data: {
          labels: dayLastArray,
          datasets: [
            {
              label: 'Temperature',
              data: tempLastArray,
              borderColor: 'rgb(255, 107, 107, 1)',
              backgroundColor: 'rgb(255, 107, 107, 0.2)',
              yAxisID: 'y',
            },
            {
              label: 'Humidity',
              data: humidLastArray,
              borderColor: 'rgb(77, 150, 255, 1)',
              backgroundColor: 'rgb(77, 150, 255, 0.2)',
              yAxisID: 'y1'
            },
            {
              label: 'Light',
              data: lightLastArray,
              borderColor: 'rgb(255, 217, 61, 1)',
              backgroundColor: 'rgb(255, 217, 61, 0.2)',
              yAxisID: 'y1'
            }
          ]
        },
        options: {
          responsive: true,
          interaction: {
            mode: 'index',
            intersect: false,
          },
          stacked: false,
          plugins: {
            title: {
              display: true,
              text: 'Chart.js Line Chart - Multi Axis'
            }
          },
          scales: {
            y: {
              type: 'linear',
              display: true,
              position: 'left',
            },
            y1: {
              type: 'linear',
              display: true,
              position: 'right',

              // grid line settings
              grid: {
                drawOnChartArea: false, // only want the grid lines for one axis to show up
              },
            },
          }
        },
      })
      // Draw temp histogram
      const x_tempHis = [20.5, 21.5, 22.5, 23.5, 24.5, 25.5, 26.5, 27.5, 28.5, 29.5];
      const y_tempHis = [...tempHistogramArray];
      // backgroundColor[parseInt(x_vals.length / 2)] = 'rgba(54, 162, 235, 0.2)';
      // borderColor[parseInt(x_vals.length / 2)] = 'rgba(54, 162, 235, 1)';
      const tempHis = document.getElementById('tempHistogramChart').getContext('2d');
      const tempHisConfig = new Chart(tempHis, {
        type: 'bar',
        data: {
          datasets: [{
            label: 'Num of days',
            data: x_tempHis.map((k, i) => ({ x: k, y: y_tempHis[i] })),
            backgroundColor: Array(x_tempHis.length).fill('rgb(255, 107, 107, 0.2)'),
            borderColor: Array(x_tempHis.length).fill('rgb(255, 107, 107, 1)'),
            borderWidth: 1,
            barPercentage: 1,
            categoryPercentage: 1,
            borderRadius: 5,
          }]
        },
        options: {
          scales: {
            x: {
              type: 'linear',
              offset: false,
              grid: {
                offset: false
              },
              ticks: {
                stepSize: 1
              },
              title: {
                display: true,
                text: 'Temperature (Celcius)',
                font: {
                  size: 14
                }
              }
            },
            y: {
              // beginAtZero: true
              title: {
                display: true,
                text: 'Good quality sleep (days)',
                font: {
                  size: 14
                }
              }
            }
          },
          plugins: {
            legend: {
              display: false,
            },
            tooltip: {
              callbacks: {
                title: (items) => {
                  if (!items.length) {
                    return '';
                  }
                  const item = items[0];
                  const x = item.parsed.x;
                  const min = x - 0.5;
                  const max = x + 0.5;
                  return `Temperature: ${min} - ${max}`;
                }
              }
            }
          }
        }
      });

      // Draw humid histogram
      const x_humidHis = [5, 15, 25, 35, 45, 55, 65, 75, 85, 95];
      const y_humidHis = [...humidHistogramArray];
      // backgroundColor[parseInt(x_vals.length / 2)] = 'rgba(54, 162, 235, 0.2)';
      // borderColor[parseInt(x_vals.length / 2)] = 'rgba(54, 162, 235, 1)';
      const humidHis = document.getElementById('humidHistogramChart').getContext('2d');
      const humidHisConfig = new Chart(humidHis, {
        type: 'bar',
        data: {
          datasets: [{
            label: 'Num of days',
            data: x_humidHis.map((k, i) => ({ x: k, y: y_humidHis[i] })),
            backgroundColor: Array(x_humidHis.length).fill('rgb(77, 150, 255, 0.2)'),
            borderColor: Array(x_humidHis.length).fill('rgb(77, 150, 255, 1)'),
            borderWidth: 1,
            barPercentage: 1,
            categoryPercentage: 1,
            borderRadius: 5,
          }]
        },
        options: {
          scales: {
            x: {
              type: 'linear',
              offset: false,
              grid: {
                offset: false
              },
              ticks: {
                stepSize: 10
              },
              title: {
                display: true,
                text: 'Humidity (%)',
                font: {
                  size: 14
                }
              }
            },
            y: {
              // beginAtZero: true
              title: {
                display: true,
                text: 'Good quality sleep (days)',
                font: {
                  size: 14
                }
              }
            }
          },
          plugins: {
            legend: {
              display: false,
            },
            tooltip: {
              callbacks: {
                title: (items) => {
                  if (!items.length) {
                    return '';
                  }
                  const item = items[0];
                  const x = item.parsed.x;
                  const min = x - 5;
                  const max = x + 5;
                  return `Humid: ${min} - ${max}`;
                }
              }
            }
          }
        }
      });


      // Draw light histogram
      const x_lightHis = [5, 15, 25, 35, 45, 55, 65, 75, 85, 95];
      const y_lightHis = [...lightHistogramArray];
      // backgroundColor[parseInt(x_vals.length / 2)] = 'rgba(54, 162, 235, 0.2)';
      // borderColor[parseInt(x_vals.length / 2)] = 'rgba(54, 162, 235, 1)';
      const lightHis = document.getElementById('lightHistogramChart').getContext('2d');
      const lightHisConfig = new Chart(lightHis, {
        type: 'bar',
        data: {
          datasets: [{
            label: 'Num of days',
            data: x_lightHis.map((k, i) => ({ x: k, y: y_lightHis[i] })),
            backgroundColor: Array(x_lightHis.length).fill('rgb(255, 217, 61, 0.2)'),
            borderColor: Array(x_lightHis.length).fill('rgb(255, 217, 61, 1)'),
            borderWidth: 1,
            barPercentage: 1,
            categoryPercentage: 1,
            borderRadius: 5,
          }]
        },
        options: {
          scales: {
            x: {
              type: 'linear',
              offset: false,
              grid: {
                offset: false
              },
              ticks: {
                stepSize: 10
              },
              title: {
                display: true,
                text: 'Light (%)',
                font: {
                  size: 14
                }
              }
            },
            y: {
              // beginAtZero: true
              title: {
                display: true,
                text: 'Good quality sleep (days)',
                font: {
                  size: 14
                }
              }
            }
          },
          plugins: {
            legend: {
              display: false,
            },
            tooltip: {
              callbacks: {
                title: (items) => {
                  if (!items.length) {
                    return '';
                  }
                  const item = items[0];
                  const x = item.parsed.x;
                  const min = x - 5;
                  const max = x + 5;
                  return `light: ${min} - ${max}`;
                }
              }
            }
          }
        }
      });

      /* Scatter Plot */
      var trace0 = {
        x: humidGoodArray,
        y: lightGoodArray,
        z: tempGoodArray,
        mode: 'markers',
        marker: {
          size: 10,
          line: {
            color: 'rgba(217, 217, 217, 0.14)',
            width: 0.5
          },
          opacity: 0.8
        },
        type: 'scatter3d',
        name: "good sleep"
      };

      var trace1 = {
        x: humidBadArray,
        y: lightBadArray,
        z: tempBadArray,
        mode: 'markers',
        marker: {
          size: 10,
          line: {
            color: 'rgba(217, 217, 217, 0.14)',
            width: 0.5
          },
          mode: 'markers',
          opacity: 0.8
        },
        type: 'scatter3d',
        name: "bad sleep"
      };

      var data = [trace0, trace1];
      var layout = {
        margin: {
          l: 0,
          r: 0,
          b: 0,
          t: 0
        },
        scene: {
          xaxis: { title: "Humid" },
          yaxis: { title: "Light" },
          zaxis: { title: "Temp" },
        },
      };
      const config = {
        displayModeBar: false, // this is the line that hides the bar.
      };
      Plotly.newPlot('scatterChart', data, layout, config);

    }
    drawChart()
    //////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // Update avg function
    async function updateSleepAvg() {
      let ada = await fetchStuff(
        "https://io.adafruit.com/api/v2/nguyennamkha/feeds"
      );
      // Check sleeping status
      if (sessionStorage.getItem("sleeping") == "yes") {
        ///////////////////////////////////////////////////////////////////
        let tempArray = JSON.parse(
          sessionStorage.getItem("tempSessionSleep")
        );
        tempArray.push(
          parseFloat(
            ada.find(
              (obj) => obj.name == sessionStorage.getItem("varSensorTemp")
            ).last_value
          )
        );
        sessionStorage.setItem("tempSessionSleep", JSON.stringify(tempArray));
        ///////////////////////////////////////////////////////////////////
        let humidArray = JSON.parse(
          sessionStorage.getItem("humidSessionSleep")
        );
        humidArray.push(
          parseFloat(
            ada.find(
              (obj) => obj.name == sessionStorage.getItem("varSensorHumid")
            ).last_value
          )
        );
        sessionStorage.setItem(
          "humidSessionSleep",
          JSON.stringify(humidArray)
        );
        ///////////////////////////////////////////////////////////////////
        let lightArray = JSON.parse(
          sessionStorage.getItem("lightSessionSleep")
        );
        lightArray.push(
          parseFloat(
            ada.find(
              (obj) => obj.name == sessionStorage.getItem("varSensorLight")
            ).last_value
          )
        );
        sessionStorage.setItem(
          "lightSessionSleep",
          JSON.stringify(lightArray)
        );
        ///////////////////////////////////////////////////////////////////
        tempAverage = parseFloat(
          tempArray.reduce((a, b) => a + b, 0) / tempArray.length
        ).toFixed(1);
        sessionStorage.setItem("tempSessionAverage", tempAverage);
        humidAverage = parseFloat(
          humidArray.reduce((a, b) => a + b, 0) / humidArray.length
        ).toFixed(1);
        sessionStorage.setItem("humidSessionAverage", humidAverage);
        lightAverage = parseFloat(
          lightArray.reduce((a, b) => a + b, 0) / lightArray.length
        ).toFixed(1);
        sessionStorage.setItem("lightSessionAverage", lightAverage);
        console.clear()
        console.log(
          "tempArray: ",
          JSON.parse(sessionStorage.getItem("tempSessionSleep"))
        );
        console.log(
          "humidArray: ",
          JSON.parse(sessionStorage.getItem("humidSessionSleep"))
        );
        console.log(
          "lightArray: ",
          JSON.parse(sessionStorage.getItem("lightSessionSleep"))
        );

        console.log(
          "tempAverage: ",
          sessionStorage.getItem("tempSessionAverage")
        );
        console.log(
          "humidAverage: ",
          sessionStorage.getItem("humidSessionAverage")
        );
        console.log(
          "lightAverage: ",
          sessionStorage.getItem("lightSessionAverage")
        );
      }
    }
    setInterval(updateSleepAvg, 10000);
  </script>
  <!-- <script src="assets/static/js/pages/2history.js"></script> -->
  <script src="assets/static/js/components/dark.js"></script>
  <script src="assets/extensions/perfect-scrollbar/perfect-scrollbar.min.js"></script>

  <script src="assets/compiled/js/app.js"></script>

  <script src="assets/extensions/simple-datatables/umd/simple-datatables.js"></script>
  <!-- <script src="assets/static/js/pages/simple-datatables.js"></script> -->

  <!-- <script src="assets/static/js/pages/ui-chartjs.js"></script> -->
</body>

</html>